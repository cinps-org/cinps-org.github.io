<script>
/* ===== BASIC SETUP ===== */
document.getElementById("year").textContent = new Date().getFullYear();

const navToggle = document.querySelector(".nav-toggle");
const navMenu = document.querySelector(".nav-menu");
navToggle.onclick = () => navMenu.classList.toggle("show");

/* ===== MODAL ELEMENTS ===== */
const modal = document.getElementById("modal");
const successPopup = document.getElementById("successPopup");
const contactForm = document.getElementById("contactForm");

/* ===== MODAL CONTROLS ===== */
function openModal() {
  modal.style.display = "flex";
}
function closeModal() {
  modal.style.display = "none";
}
function closeSuccess() {
  successPopup.style.display = "none";
}

/* ===== CONTACT FORM SUBMIT ===== */
const FORM_API =
"https://script.google.com/macros/s/AKfycbx238EEzhTfcYGngAQD6CeXZIYqt0KqKp7_3iiR3ZVffUeO-Sik8dqmoXE7daNBcTxZlQ/exec";

contactForm.addEventListener("submit", function (e) {
  e.preventDefault();

  fetch(FORM_API, {
    method: "POST",
    body: new FormData(contactForm),
  })
    .then(() => {
      closeModal();
      successPopup.style.display = "flex";
      contactForm.reset();
    })
    .catch(() => {
      alert("Submission failed. Please try again.");
    });
});

/* ===== CINPS PULSE AI ===== */
const chatBtn = document.getElementById("cinps-chat-btn");
const chatBox = document.getElementById("cinps-chat-box");
const messages = document.getElementById("cinps-chat-messages");
const input = document.getElementById("cinps-user-input");
const sendBtn = document.getElementById("cinps-send-btn");

const CHAT_API =
"https://script.google.com/macros/s/AKfycbzo06VO3zeKRV5qba98_ClEMGHFtRItIyFQR_LPPQ5NTJ40MoXY0tsWQQQv0vf0RpR3Tw/exec";

chatBtn.onclick = () => {
  chatBox.style.display =
    chatBox.style.display === "flex" ? "none" : "flex";
};

sendBtn.onclick = sendMessage;
input.addEventListener("keypress", e => {
  if (e.key === "Enter") sendMessage();
});

function addMessage(text, cls) {
  const div = document.createElement("div");
  div.className = "cinps-msg " + cls;
  div.innerHTML = text.replace(/\n/g, "<br>");
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

function sendMessage() {
  const msg = input.value.trim();
  if (!msg) return;

  addMessage(msg, "user");
  input.value = "";

  addMessage("ðŸ§  Pulse AI is thinkingâ€¦", "bot");

  fetch(CHAT_API, {
    method: "POST",
    body: JSON.stringify({ message: msg }),
  })
    .then(res => res.json())
    .then(data => {
      messages.lastChild.remove();
      addMessage(data.reply || "Please contact CINPS office.", "bot");
    })
    .catch(() => {
      messages.lastChild.remove();
      addMessage(
        "ðŸ“ž Please contact CINPS office at +91 8101579839.",
        "bot"
      );
    });
}
</script>
